{"version":3,"file":"d3-treemap.js","sources":["src/nestedTreemap.js","index.js"],"sourcesContent":["export var nestedTreemap = (function() {\n \n\n \tvar container = {};\n\tvar svg = {};\n\tvar root = {};\n\tvar data;\n\tvar treemap = {};\n\tvar nested = {};\n\tvar nestings = {};\n\tvar url = {};\n\tvar width = {};\n\tvar height = {};\n\tvar dropdownA = {};\n\tvar dropdownB = {};\n\tvar levelA = \"\";\n\tvar levelB = \"\";\n\tvar format;\n\tvar color;\n\n\n\tvar init = function (containerSelector) {\n\t\t\n\t\tcontainer = d3.select(containerSelector);\n\t    createSelectors();\n\n\t\tsvg = container\n\t\t\t.append(\"svg\")\n\t\t\t.attr(\"id\", \"treemap-visualization\")\n\t\t\t.attr(\"width\", window.innerWidth)\n\t\t\t.attr(\"height\", window.innerHeight);\n\n\t    width = +svg.attr(\"width\"),\n\t    height = +svg.attr(\"height\");\n\t\tformat = d3.format(\",d\");\n\t\tcolor = d3.scaleMagma().domain([-1, 4]);\n\n\t\ttreemap = d3.treemap()\n\t\t\t.size([width, height])\n\t\t\t.paddingOuter(3)\n\t\t\t.paddingTop(15)\n\t\t\t.paddingInner(3)\n\t\t\t.round(false);\n\n\t};\n\n\n\tvar setLevelA = (string) => levelA = string;\n\tvar setLevelB = (string) => levelB = string;\n\n\n\tvar update = function() {\n\n\t\tnested = d3.nest()\n\t\t\t.key( nestings[levelA] )\n\t\t\t.key( nestings[levelB] )\n\t\t\t.rollup( function (leaves) { return {\"size\" : leaves.length } ; } )\n\t\t\t.entries( data );\n\n\t\t// from values and keys to children and name\n\t\tnested = JSON.parse( JSON.stringify(nested).replace(/\"key\":/gi, '\"name\":').replace(/\"values\":/gi, '\"children\":') );\n\n\t\t// get the size of each cell\n\t\tnested.forEach( function (major) {\n\t\t\tvar majorSize = 0;\n\t\t\tmajor.children.forEach( function(minor) {\n\t\t\t\t//majorSize += minor.children.size;\n\t\t\t\tminor.size = minor.children.size;\n\t\t\t\tdelete(minor.children);\n\t\t\t});\n\t\t\tmajor.size = majorSize;\n\t\t});\n\n\t\t//console.log(nested);\n\n\t\troot = d3\n\t\t\t.hierarchy({\n\t\t\t\t\"name\" : \"root\", \n\t\t\t\t\"children\" : nested, \n\t\t\t\t\"size\" : 0\n\t\t\t}, function(d) { return d.children; })\n\t\t\t.sum(function(d) { return d.size; })\n\t\t\t.sort(function(a, b) { return b.height - a.height || b.data.size - a.data.value; });\n\n\t\ttreemap(root);\n\n\t\tfunction updateNode (s) {\n\t\t\t//console.log(s);\n\t\t\ts.attr(\"transform\", function(d) { return \"translate(\" + d.x0 + \",\" + d.y0 + \")\"; })\n\t\t}\n\n\t\tfunction updateCell (s) {\n\t\t\t//console.log(s);\n\t\t\ts\n\t\t\t.attr(\"width\", function(d) { return d.x1 - d.x0; })\n\t\t\t.attr(\"height\", function(d) { return d.y1 - d.y0; })\n\t\t\t.style(\"fill\", function(d) {return color(d.depth); })\n\t\t}\n\n\t\tsvg.selectAll(\".node\").remove();\n\n\t\tvar nodes = svg.selectAll(\".node\");\n\n\t\tnodes\n\t\t\t.data(root.descendants())\n\t\t\t.call(updateNode);\n\n\t\tnodes\n\t\t\t.data(root.descendants())\n\t\t\t.enter().append(\"g\")\n\t\t\t.classed(\"node\", true)\n\t\t\t//.attr(\"id\", function(d) { return \"rect-\" + d.data.name; })\n\t\t\t.each(function (d) { d.node = this; })\n\t\t\t.on(\"mouseover\", function(d) { console.log(d.data.name); })\n\t\t\t.call(updateNode)\n\t\t\t//.select(\"rect\")\n\t\t\t//.data(function (d) { console.log(d); })\n\t\t\t.append(\"rect\")\n\t\t\t//.attr(\"id\", function(d) { console.log(d); return \"rect-\" + d.id; })\n\t\t\t.call(updateCell);\n\n\t\tnodes\n\t\t\t.data(root.descendants())\n\t\t\t.exit()\n\t\t\t.remove();\n\n\t\t\n\t\t//cells.append(\"clipPath\")\n\t\t//.attr(\"id\", function(d) { return \"clip-\" + d.id; })\n\t\t//.append(\"use\")\n\t\t//.attr(\"xlink:href\", function(d) { return \"#rect-\" + d.id + \"\"; });\n\t\t\n\t\t\n\t\t\n\t\t// var label = nodes\n\t\t// .append(\"text\")\n\t\t// .attr(\"clip-path\", function(d) { return \"url(#clip-\" + d.id + \")\"; });\n\n\t\t// label = nodes\n\t\t// \t.selectAll(\"text\")\n\t\t// \t.data(function(d) {\n\t\t// \t\treturn d.data.name;\n\t\t// \t\t//.id.substring(d.id.lastIndexOf(\".\") + 1).split(/(?=[A-Z][^A-Z])/g).concat(\"\\xa0\" + format(d.value));\n\t\t// \t})\n\t\t// \t.enter().append(\"text\")\n\t\t// \t.attr(\"x\", (d, i) => { return i ? null : 4; })\n\t\t// \t.attr(\"y\", 13)\n\t\t// \t.text( d => { return d; });\n\n\t\t//nodes.append(\"title\").text(function(d) { return d.id + \"\\n\" + format(d.value); });\n\t\t\n\n  };\n\n\n\tvar createSelectors = function () {\n\t\tvar n = d3.keys(nestings);\n\n\t\tdropdownA = container.append(\"select\").attr(\"id\", \"dropdown-a\");\n\t\tdropdownB = container.append(\"select\").attr(\"id\", \"dropdown-b\");\n\t\tdropdownA.on(\"change\", function() { levelA = d3.select(this).property(\"value\"); update(); });\n\t\tdropdownB.on(\"change\", function() { levelB = d3.select(this).property(\"value\"); update(); });\n\n\t\tdropdownA\n\t\t\t.selectAll(\"option\")\n\t\t\t.data(n)\n\t\t\t.enter()\n\t\t\t.append(\"option\")\n\t\t\t.attr(\"value\", d => { return d; })\n\t\t\t.text( d => { return d; });\n\n\t\tdropdownB\n\t\t\t.selectAll(\"option\")\n\t\t\t.data(n)\n\t\t\t.enter()\n\t\t\t.append(\"option\")\n\t\t\t.attr(\"value\", d => { return d; })\n\t\t\t.text(d => { return d; });\n\t};\n\n\n\tvar addNesting = function (name, f) { nestings[name] = f; };\n\t\n\n\tvar loadData = function (dataURL) {\n\t\td3.json(dataURL, result => { \n\t\t\tdata = result;\n\t\t\tupdate();\n\t\t});\n\t};\n\n\n  \treturn {\n\t    levelA : levelA,\n\t    levelB : levelB,\n\t    nested : nested,\n\t    nestings : nestings,\n\n\t    init : init,\n\t    update : update,\n\t    loadData : loadData,\n\t    createSelectors : createSelectors,\n\n\t    addNesting : addNesting,\n\t    setLevelA : setLevelA,\n\t    setLevelB : setLevelB\n\t};\n\n}());","\n// import my module\nimport {nestedTreemap as ntr} from \"./src/nestedTreemap.js\";\nconsole.log(ntr);\n\n// define the initial nesting values\nntr.setLevelA(\"Schultyp\");\nntr.setLevelB(\"Schullevel\");\n\n// add the nestings and accessor functions\nntr.addNesting(\"Schulfach\", function (d) { return (d.subject==undefined) ? \"Schulfach unbekannt\" : d.subject });\nntr.addNesting(\"Schultyp\", function levelA(d) { return (d.schooltype==undefined) ? \"Schultyp unbekannt\" : d.schooltype; });\nntr.addNesting(\"Schullevel\", function (d) { return (d.schoollevel==undefined) ? \"Schullevel unbekannt\" : d.schoollevel });\nntr.addNesting(\"Ort\", function (d) { return (d.publisher_city==undefined) ? \"Ort unbekannt\" : d.publisher_city; });\nntr.addNesting(\"Verlag\", function (d) { return (d.publisher==undefined) ? \"Verlag unbekannt\" : d.publisher; });\n\n// initialize with the selector of the parent element\nntr.init(\"#treemap\");\n\n// load the data \nntr.loadData(\"../../data/better-data.json\");"],"names":["ntr"],"mappings":"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"}